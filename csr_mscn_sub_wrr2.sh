#!/bin/bash

#extract CSR by LandMask
cdo setctomiss,0 CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask.nc CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask_setctomiss.nc
cdo mul CSR_GRACE_GRACE-FO_RL06_Mascons_all-corrections_v02.nc CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask_setctomiss.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02.nc
cdo setmissval,-99999 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval.nc
#monmean CSR to ensure that one time-step each month
cdo monmean CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc
#choose corresponding CSR months
cdo seldate,2002-04-01,2014-12-31 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate.nc

#setmissval the TWS of univu and watergap
cdo setmissval,-99999 e2o_univu_wrr2_glob15_mon_TWS_1980-2014.nc e2o_univu_wrr2_glob15_setmissval_mon_TWS_1980-2014.nc
cdo setmissval,-99999 watergap_22d_WFDEI-GPCC_histsoc_tws_monthly_2000_2016.nc4 watergap_22d_WFDEI-GPCC_histsoc_setmissval_tws_monthly_2000_2016.nc

#sellonlatbox
cdo sellonlatbox,-180,180,-60,90 e2o_univu_wrr2_glob15_setmissval_mon_TWS_1980-2014.nc e2o_univu_wrr2_glob15_setmissval_sellonlatbox_mon_TWS_1980-2014.nc
cdo sellonlatbox,-180,180,-60,90 watergap_22d_WFDEI-GPCC_histsoc_setmissval_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_tws_monthly_2000_2016.nc
#find Latitude orientation differ! Second grid: N->S
#remapycon from Second grid: N->S of univu and watergap to First grid: S->N of CSR
cdo -remapycon,CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc e2o_univu_wrr2_glob15_setmissval_sellonlatbox_mon_TWS_1980-2014.nc e2o_univu_wrr2_glob15_setmissval_sellonlatbox_remapycon_mon_TWS_1980-2014.nc

cdo -remapycon,CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_remapycon_tws_monthly_2000_2016.nc

#choose overlapping year-intervals of univu and watergap

cdo seldate,2000-01-01,2014-12-31 e2o_univu_wrr2_glob15_setmissval_sellonlatbox_remapycon_mon_TWS_1980-2014.nc e2o_univu_wrr2_glob15_setmissval_sellonlatbox_remapycon_seldate_mon_TWS_2000_2014.nc

cdo seldate,2000-01-01,2014-12-31 watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_remapycon_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_remapycon_seldate_tws_monthly_2000_2014.nc


#ensmean TWS
cdo ensmean e2o_univu_wrr2_glob15_setmissval_sellonlatbox_remapycon_seldate_mon_TWS_2000_2014.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_sellonlatbox_remapycon_seldate_tws_monthly_2000_2014.nc wrr2_glob15_mon_TWS_2000_2014.nc

cdo mulc,0.1 wrr2_glob15_mon_TWS_2000_2014.nc wrr2_glob15_mulc_mon_TWS_2000_2014.nc

#caculate baseline 200401_200912
cdo seldate,2004-01-01,2009-12-31 wrr2_glob15_mulc_mon_TWS_2000_2014.nc wrr2_glob15_mulc_seldate_mon_TWS_2004_2009.nc
cdo timmean wrr2_glob15_mulc_seldate_mon_TWS_2004_2009.nc wrr2_glob15_mulc_seldate_timmean_mon_TWS_2004_2009.nc
cdo sub wrr2_glob15_mulc_mon_TWS_2000_2014.nc wrr2_glob15_mulc_seldate_timmean_mon_TWS_2004_2009.nc wrr2_glob15_mulc_GRACE_GRACE-FO_mon_TWS_2000_2014.nc
cdo setname,lwe_thickness wrr2_glob15_mulc_GRACE_GRACE-FO_mon_TWS_2000_2014.nc wrr2_glob15_mulc_setname_GRACE_GRACE-FO_mon_TWS_2000_2014.nc
#remapbil from TWS to CSR
cdo remapbil,CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc wrr2_glob15_mulc_setname_GRACE_GRACE-FO_mon_TWS_2000_2014.nc wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_mon_TWS_2000_2014.nc

#choose corresponding model months(2002-04-01ï¼Œ2017-06-01)
cdo seldate,2002-04-01,2014-12-31 wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_mon_TWS_2000_2014.nc wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_seldate_mon_TWS_2002_2014.nc

#delete correspoding CSR months: delete,date=2002-06,2002-07,2003-06,2011-01,2011-06,2011-11,2012-05,2012-10,2013-03,2013-08,2013-09,2014-02,2014-07,2014-12,2015-05,2015-06,2015-10,2015-11,2016-04,2016-09,2016-10,2017-02
cdo delete,date=2002-06-30,2002-07-31,2003-06-30,2011-01-31,2011-06-30,2011-11-30,2012-05-31,2012-10-31,2013-03-31,2013-08-31,2013-09-30,2014-02-28,2014-07-31,2014-12-31 wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_seldate_mon_TWS_2002_2014.nc wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_seldate_deletedate_mon_TWS_2002_2014.nc
#CSR sub model, corresponding to sediment changes
cdo sub CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate.nc wrr2_glob15_mulc_setname_remapbil_CSR_GRACE_GRACE-FO_seldate_deletedate_mon_TWS_2002_2014.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_wrr2.nc
#covert from lwe_thickness to est_thickness, dividing by 1.58g/cm3
cdo divc,1.58 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_wrr2.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_wrr2_divc.nc

#splitsel
cdo splitsel,1 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_wrr2_divc.nc csr_mscn_sub_wrr2_




done
