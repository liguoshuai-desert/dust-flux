#!/bin/bash

#extract CSR by LandMask
cdo setctomiss,0 CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask.nc CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask_setctomiss.nc
cdo mul CSR_GRACE_GRACE-FO_RL06_Mascons_all-corrections_v02.nc CSR_GRACE_GRACE-FO_RL06_Mascons_v02_LandMask_setctomiss.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02.nc
cdo setmissval,-99999 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval.nc
#monmean CSR to ensure that one time-step each month
cdo monmean CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc
#choose corresponding CSR months
cdo seldate,2002-04-01,2014-12-31 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate.nc

#setmissval watergap
cdo setmissval,-99999 watergap_22d_WFDEI-GPCC_histsoc_tws_monthly_2000_2016.nc4 watergap_22d_WFDEI-GPCC_histsoc_setmissval_tws_monthly_2000_2016.nc
#calculate TWS, the sum of soil moisture in all layers, accumulated snow, and plant canopy surface water (no considering in desert), unit converted into cm
cdo mulc,0.1 watergap_22d_WFDEI-GPCC_histsoc_setmissval_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_tws_monthly_2000_2016.nc

#calculate baseline 200401_200912
cdo seldate,2004-01-01,2009-12-31 watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_tws_monthly_2004_2009.nc
cdo timmean watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_tws_monthly_2004_2009.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_timmean_tws_monthly_2004_2009.nc
cdo sub watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_timmean_tws_monthly_2004_2009.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_grace_tws_monthly_2000_2016.nc
cdo setname,lwe_thickness watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_grace_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_grace_tws_monthly_2000_2016.nc
#remapbil to CSR
cdo remapbil,CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_grace_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_tws_monthly_2000_2016.nc


#choose corresponding model months(2002-04-01，2017-06-01)
cdo seldate,2002-04-01,2014-12-31 watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_tws_monthly_2000_2016.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_seldate_tws_monthly_200204_201412.nc

#delete correspoding CSR months: delete,date=2002-06,2002-07,2003-06,2011-01,2011-06,2011-11,2012-05,2012-10,2013-03,2013-08,2013-09,2014-02,2014-07,2014-12,2015-05,2015-06,2015-10,2015-11,2016-04,2016-09,2016-10,2017-02
cdo delete,date=2002-06-01,2002-07-01,2003-06-01,2011-01-01,2011-06-01,2011-11-01,2012-05-01,2012-10-01,2013-03-01,2013-08-01,2013-09-01,2014-02-01,2014-07-01,2014-12-01 watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_seldate_tws_monthly_200204_201412.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_seldate_deletedate_tws_monthly_200204_201412.nc


#CSR sub model, corresponding to sediment changes
cdo sub CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate.nc watergap_22d_WFDEI-GPCC_histsoc_setmissval_mulc_seldate_setname_remapbil_CSR_grace_seldate_deletedate_tws_monthly_200204_201412.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_watergap.nc
#covert from lwe_thickness to est_thickness, dividing by 1.58g/cm3
cdo divc,1.58 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_watergap.nc CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_watergap_divc.nc

#分解
cdo splitsel,1 CSR_GRACE_GRACE-FO_RL06_Land_Mascons_all-corrections_v02_setmissval_monmean_seldate_sub_watergap_divc.nc csr_mscn_sub_watergap_








done
